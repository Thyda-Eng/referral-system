<% content_for :breadcrumb do %>
  <%=  breadcrumb [
  		{ "Report" => referral_reports_path},
                { "Simulate report" => nil}
  	] %>
<% end %>
<%= render "nav_report" %>

<div class="row-fluid" >
  <div class="span4" >

  <div class="well" >    
      <h4> Simulate SMS Message </h4>

      <%= form_tag referral_reports_simulate_path do %>

        <%= tag_row do %>
          <%=  label_tag  "from" %>
          <%=  text_field_tag "from", @from, :style=> "width: 96%;" %>
        <%end%>

        <%= tag_row do %>
          <%=  label_tag  "body" %>
          <%=  text_field_tag "body", @body, :style=> "width: 96%;" %>
        <%end%>

        <%= tag_row do %>
          <%=  label_tag  "guid" %>
          <%=  text_field_tag "guid", @guid, :style=> "width: 96%;" %>
        <%end%>

        <%= tag_row do %>
          <input type="submit" class="btn btn-danger" value="Simulate" name="sumbit" />
        <%end %>

      <% end %>
    </div>
    
    <div class="well">
        <h4> Message simulation note : </h4>
        <p>
          This page will simulate just like you send the real message via your phone.
          No message will be sent to the real number, instead it allows you to see the 
          generated messages and the phone that messages will be sent. It also allows you 
          to see the report generated by the simulator. The report is saved in the 
          database with ignored attribute set to true.
        </p>
    </div>
  </div>

  <div class="span8">
    <div >
      <% if !@messages.nil? && @messages.size %>
        <h4> SMS(s) sent </h4>
        <table class="table">
          <tr>
            <td width="150">To</td>
            <td>Text sent</td>
            <td width="100">From</td>
          </tr>

          <% @messages.each do |message| %>
            <tr>
              <td><%= message[:to] %> </td>
              <td><%= message[:body] %></td>
              <td><%= message[:from] %></td>
            </tr>
          <%end %>
        </table>  
      <% else %>
      <% end %>
    </div>  

    <div >
      <% if !@report.nil? %>
        
        <h4> Report Generated:  <%= @report.class %>
          <% cls =  @report.error ? "label-warning" : "label-success" %>
          <span class="label <%=cls%>">
            <%= @report.error ? "Error" : "Success" %>
          </span>
        </h4>
        <table class="table-grid table" > 
            <tr> 
              <th style="text-align: left;"> Field </th>
              <th style="text-align: left;" > Value </th>
            </tr>

          <% @report.attributes.each do |name, value|  %>
            <tr > 
              <td> <%= name %> </td>
              <td> : 
                   <%=  ( (@report.class == Referral::HCReport || @report.class == Referral::ClinicReport) && name == "error_message") ? @report.error_message_translate : value  %>
              </td>
            </tr>
          <% end %>
          </table> 

      <% else %>  
      <%end%>
        <div class="clearfix" >&nbsp;</div>  
        <br />
    </div>   
  </div> 
</div>